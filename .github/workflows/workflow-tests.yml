name: Automated linter and testing 

on:
  workflow_call:

jobs:

  lint-and-test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [16.x, 14.x]
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/

    steps:
     - uses: actions/checkout@v3
     
     - name: Use Node.js ${{ matrix.node-version }}
       uses: actions/setup-node@v3
       with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
     
     - name: Cache dependencies
       id: cache
       uses: actions/cache@v3
       with:
          path: ./node_modules
          key: modules-${{ hashFiles('package-lock.json') }}

     - name: Install dependencies
       if: steps.cache.outputs.cache-hit != 'true'
       run: npm ci

     - name: Build project
       run: npm run build --if-present

     - name: Run prettier
       run: npm run lint
     
     - name: Run tests
       run: npm run test